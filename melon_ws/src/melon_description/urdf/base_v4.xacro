<?xml version="1.0" ?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find melon_description)/urdf/materials.xacro" />
  <xacro:include filename="$(find melon_description)/urdf/base_v2.ros2control.xacro" />
  <!-- <xacro:include filename="$(find melon_description)/urdf/base_v2.gazebo.xacro" /> -->

  <xacro:macro name="base" params="prefix">
    <!-- base -->
    <link name="${prefix}base_footprint"/>

    <joint name="${prefix}base_joint" type="fixed">
      <parent link="${prefix}base_footprint"/>
      <child link="${prefix}base_link" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>

    <link name="${prefix}base_link">
      <inertial>
        <origin xyz="0.01744420260337036 0.0763481410355218 0.4235647920657504" rpy="0 0 1.57"/>
        <mass value="50.0"/>
        <inertia ixx="16.050446" iyy="13.982493" izz="18.567703" ixy="0.002034" iyz="-2.999695" ixz="0.007151"/>
      </inertial>

      <!-- <visual>
        <origin xyz="0 0 0" rpy="0 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="silver"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision> -->

      <!-- body -->
      <visual>
        <origin xyz="-0.002 0.005 0.05" rpy="0 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/body_1.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="midnight_blue"/>
      </visual>
      <collision>
        <origin xyz="-0.002 0.005 0.05" rpy="0 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/body_1.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0.0075 0.678 0.069" rpy="0 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/body_2.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="dark_black"/>
      </visual>
      <collision>
        <origin xyz="0.0075 0.678 0.069" rpy="0 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/body_2.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0.027 0.025 0.37" rpy="0 0 -1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/body_3.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="charcoal"/>
      </visual>
      <collision>
        <!-- <origin xyz="0.027 0.025 0.37" rpy="0 0 -1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/body_3.stl" scale="0.001 0.001 0.001"/>
        </geometry> -->
        <origin xyz="0.008 0.0 0.415" rpy="0 0 0"/>
        <geometry>
          <box size="0.8 0.7 0.1"/>
        </geometry>
      </collision>
      <collision>
        <origin xyz="0.258 0.0 0.615" rpy="0 0 0"/>
        <geometry>
          <box size="0.3 0.7 0.3"/>
        </geometry>
      </collision>
      <collision>
        <origin xyz="-0.14 0.335 0.495" rpy="0 0 0"/>
        <geometry>
          <box size="0.5 0.03 0.06"/>
        </geometry>
      </collision>
      <collision>
        <origin xyz="-0.14 -0.335 0.495" rpy="0 0 0"/>
        <geometry>
          <box size="0.5 0.03 0.06"/>
        </geometry>
      </collision>

      <!-- caster mount -->
      <visual>
        <origin xyz="0.3 0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="midnight_blue"/>
      </visual>
      <collision>
        <origin xyz="0.3 0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0.3 -0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="midnight_blue"/>
      </visual>
      <collision>
        <origin xyz="0.3 -0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="-0.33 0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="midnight_blue"/>
      </visual>
      <collision>
        <origin xyz="-0.33 0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="-0.33 -0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="midnight_blue"/>
      </visual>
      <collision>
        <origin xyz="-0.33 -0.200 0.06" rpy="3.14 0 1.57"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/ballfoint.stl" scale="0.001 0.001 0.001"/>
        </geometry>
      </collision>
    </link>

    <!-- wheels -->
    <joint name="${prefix}right_wheel_joint" type="continuous">
      <origin xyz="0.007002 -0.242002 0.10065" rpy="0 0 1.57"/>
      <parent link="${prefix}base_link"/>
      <child link="${prefix}right_wheel_1"/>
      <axis xyz="1.0 0.0 0.0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}right_wheel_1">
      <inertial>
        <origin xyz="-0.020080456317257633 -2.190901024334141e-07 -9.838097278502822e-08" rpy="0 0 0"/>
        <mass value="0.5"/>
        <inertia ixx="0.005139" iyy="0.002706" izz="0.002706" ixy="-0.0" iyz="0.0" ixz="-0.0"/>
      </inertial>

      <visual>
        <origin xyz="0.242002 0.007002 -0.10065" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/right_wheel_1.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="dark"/>
      </visual>
      <collision>
        <origin xyz="-0.04 0.0 0.0" rpy="0 1.57 0"/>
        <geometry>
          <cylinder length="0.05" radius="0.10065"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}left_wheel_joint" type="continuous">
      <origin xyz="0.007002 0.279998 0.10065" rpy="0 0 1.57"/>
      <parent link="${prefix}base_link"/>
      <child link="${prefix}left_wheel_1"/>
      <axis xyz="1.0 0.0 0.0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}left_wheel_1">
      <inertial>
        <origin xyz="0.019919543682742402 -2.1909010231892234e-07 -9.838097249359468e-08" rpy="0 0 0"/>
        <mass value="0.5"/>
        <inertia ixx="0.005139" iyy="0.002706" izz="0.002706" ixy="0.0" iyz="0.0" ixz="0.0"/>
      </inertial>
      
      <visual>
        <origin xyz="-0.277998 0.007002 -0.10065" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/left_wheel_1.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="dark"/>
      </visual>
      <collision>
        <origin xyz="0.01 0.0 0.0" rpy="0 1.57 0"/>
        <geometry>
          <cylinder length="0.05" radius="0.10065"/>
        </geometry>
      </collision>
    </link>

    <!-- passive wheel -->
    <!-- front left -->
    <joint name="${prefix}front_left_passive_wheel_x_frame_joint" type="continuous">
      <parent link="${prefix}base_link" />
      <child link="${prefix}front_left_passive_wheel_x_frame" />
      <axis xyz="1.0 0.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0.3 0.2 0.025" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}front_left_passive_wheel_x_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}front_left_passive_wheel_y_frame_joint" type="continuous">
      <parent link="${prefix}front_left_passive_wheel_x_frame" />
      <child link="${prefix}front_left_passive_wheel_y_frame" />
      <axis xyz="0.0 1.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}front_left_passive_wheel_y_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}front_left_passive_wheel_z_frame_joint" type="continuous">
      <parent link="${prefix}front_left_passive_wheel_y_frame" />
      <child link="${prefix}front_left_passive_wheel_z_link" />
      <axis xyz="0.0 0.0 1.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}front_left_passive_wheel_z_link">
      <visual>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
        <material name="dark"/>
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
      </collision>
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <!-- front right -->
    <joint name="${prefix}front_right_passive_wheel_x_frame_joint" type="continuous">
      <parent link="${prefix}base_link" />
      <child link="${prefix}front_right_passive_wheel_x_frame" />
      <axis xyz="1.0 0.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0.3 -0.2 0.025" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}front_right_passive_wheel_x_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}front_right_passive_wheel_y_frame_joint" type="continuous">
      <parent link="${prefix}front_right_passive_wheel_x_frame" />
      <child link="${prefix}front_right_passive_wheel_y_frame" />
      <axis xyz="0.0 1.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}front_right_passive_wheel_y_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}front_right_passive_wheel_z_frame_joint" type="continuous">
      <parent link="${prefix}front_right_passive_wheel_y_frame" />
      <child link="${prefix}front_right_passive_wheel_z_link" />
      <axis xyz="0.0 0.0 1.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}front_right_passive_wheel_z_link">
      <visual>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
        <material name="dark"/>
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
      </collision>
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <!-- back left-->
    <joint name="${prefix}back_left_passive_wheel_x_frame_joint" type="continuous">
      <parent link="${prefix}base_link" />
      <child link="${prefix}back_left_passive_wheel_x_frame" />
      <axis xyz="1.0 0.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="-0.33 0.2 0.025" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}back_left_passive_wheel_x_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}back_left_passive_wheel_y_frame_joint" type="continuous">
      <parent link="${prefix}back_left_passive_wheel_x_frame" />
      <child link="${prefix}back_left_passive_wheel_y_frame" />
      <axis xyz="0.0 1.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}back_left_passive_wheel_y_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}back_left_passive_wheel_z_frame_joint" type="continuous">
      <parent link="${prefix}back_left_passive_wheel_y_frame" />
      <child link="${prefix}back_left_passive_wheel_z_link" />
      <axis xyz="0.0 0.0 1.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}back_left_passive_wheel_z_link">
      <visual>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
        <material name="dark"/>
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
      </collision>
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <!-- back right-->
    <joint name="${prefix}back_right_passive_wheel_x_frame_joint" type="continuous">
      <parent link="${prefix}base_link" />
      <child link="${prefix}back_right_passive_wheel_x_frame" />
      <axis xyz="1.0 0.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="-0.33 -0.2 0.025" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}back_right_passive_wheel_x_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}back_right_passive_wheel_y_frame_joint" type="continuous">
      <parent link="${prefix}back_right_passive_wheel_x_frame" />
      <child link="${prefix}back_right_passive_wheel_y_frame" />
      <axis xyz="0.0 1.0 0.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}back_right_passive_wheel_y_frame">
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <joint name="${prefix}back_right_passive_wheel_z_frame_joint" type="continuous">
      <parent link="${prefix}back_right_passive_wheel_y_frame" />
      <child link="${prefix}back_right_passive_wheel_z_link" />
      <axis xyz="0.0 0.0 1.0" />
      <limit effort="1.0" velocity="3.0" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <dynamics damping="1.0"/>
    </joint>

    <link name="${prefix}back_right_passive_wheel_z_link">
      <visual>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
        <material name="dark"/>
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.025"/>
        </geometry>
      </collision>
      <inertial>
          <mass value="0.2"/>
          <origin xyz="0 0 0"/>
          <inertia ixx="0.001" ixy="0" ixz="0" 
                   iyy="0.001" iyz="0" 
                   izz="0.001"/>
      </inertial>
    </link>

    <!-- base_scan -->
    <joint name="${prefix}base_scan_joint" type="fixed">
      <parent link="${prefix}base_link"/>
      <child link="${prefix}base_scan"/>
      <origin xyz="0.28 0  0.125" rpy="0 0 0"/>
    </joint>

    <link name="${prefix}base_scan">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.25"/>
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                 iyy="0.0001" iyz="0.0"
                 izz="0.0001"/>
      </inertial>

      <visual>
        <origin xyz="0 0.28 -0.125" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://melon_description/meshes/lider_1.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="black"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <cylinder length="0.05" radius="0.05"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 -0.02" rpy="0 0 0"/>
        <geometry>
          <box size="0.11 0.11 0.02"/>
        </geometry>
        <material name="charcoal"/>
      </visual>
      <collision>
        <origin xyz="0 0 -0.02" rpy="0 0 0"/>
        <geometry>
          <box size="0.11 0.11 0.02"/>
        </geometry>
      </collision>
    </link>

    <!-- mount -->
    <link name="${prefix}mid_mount"/>
    <joint name="${prefix}mid_mount_joint" type="fixed">
      <parent link="${prefix}base_link"/>
      <child link="${prefix}mid_mount"/>
      <origin xyz="0.3 0 0.765" rpy="0 0 1.57"/>
    </joint>

  </xacro:macro>

  <!-- <xacro:base prefix=""/> -->

</robot>
